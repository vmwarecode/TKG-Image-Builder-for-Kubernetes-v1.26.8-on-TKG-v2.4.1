- name: "aide: install"
  package:
    name:
    - aide
    - aide-common
    - nullmailer
    state: present
  when:
    install_aide
    
- name: "aide: init"
  shell: if test -x /usr/sbin/aideinit; then aideinit; else aide -i; fi
  when:
    install_aide

- name: "aide: copy aide.db"
  copy:
    src: /var/lib/aide/aide.db.new
    dest: /var/lib/aide/aide.db
    remote_src: yes
  when:
    install_aide

- name: "aide: update-aide.conf"
  command: update-aide.conf
  when:
    install_aide

- name: "aide: copy aide.conf"
  copy:
    src: /var/lib/aide/aide.conf.autogenerated
    dest: /etc/aide/aide.conf
    remote_src: yes
  when:
    install_aide

- name: "aide: copy aidecheck.service"
  copy:
    src: files/aidecheck.service
    dest:  /etc/systemd/system/
    group: root
    owner: root
    mode: 0644
  when:
    install_aide
  
- name: "aide: copy aidecheck.timer"
  copy:
    src: files/aidecheck.timer
    dest:  /etc/systemd/system/
    group: root
    owner: root
    mode: 0644
  when:
    install_aide

- name: "aide: aidecheck.service reload"
  systemd:
    name: aidecheck.service
    state: started
    enabled: yes
    daemon_reload: yes
  when:
    install_aide
  
- name: "aide: aidecheck.timer reload"
  systemd:
    name: aidecheck.timer
    state: started
    enabled: yes
    daemon_reload: yes
  when:
    install_aide